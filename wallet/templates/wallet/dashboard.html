{% extends "wallet/components/base.html" %}
{% load static %}
{% load wallet_extras %}

{% block logo %}
    ZÄ—ndi Dashboard
{% endblock %}

{% block content %}

    <!--suppress HtmlUnknownTarget, XmlInvalidId -->
    <div id="dashboard">

        {# message box #}
        <div class="row">
            <div class="col s8 offset-s2">
                {% include 'wallet/components/message_box.html' %}
            </div>
        </div>

        <div class="row">
            <div class="col s8 offset-s2 content">
                <div class="row">
                    <div class="col s4 offset-s4 card horizontal" id="balance-card">
                        <div class="card-content center-align">
                            <span class="card-title">Balance</span>
                            <p class="user-balance">{{ balance|iota_display_format }}</p>
                            <p class="user-mail">{{ request.user.email }}</p>
                        </div>
                        <div class="card-image">
                            <img src="{% static 'wallet/img/iota-logo.png' %}" alt="IOTA Logo">
                        </div>
                    </div>
                </div>
                <div class="row recent-transactions">
                    <h1>Recent Transactions</h1>
                    <ul class="collapsible collapsible-accordion transactions" data-collapsible="accordion">

                        {% for transaction in transactions %}

                            <li class="transaction">
                                <div class="collapsible-header row">
                                    <div class="col s1 icon">
                                        <i class="material-icons">
                                            {% if transaction.value == 0 %}
                                                remove
                                            {% elif transaction.in_going %}
                                                call_received
                                            {% else %}
                                                call_made
                                            {% endif %}
                                        </i>
                                    </div>
                                    <div class="col s4">
                                        <span>
                                            {% if transaction.email %}
                                                {{ transaction.email }}
                                            {% else %}
                                                {{ transaction.address|truncatechars:20 }}
                                            {% endif %}
                                        </span>
                                    </div>
                                    <div class="col s3">{{ transaction.time }}</div>
                                    <div class="col s2">{{ transaction.value|iota_display_format }}</div>
                                    <div class="col s2 left-align">
                                        {% if transaction.is_confirmed %}
                                            <span class="new badge green"
                                                  data-badge-caption="">Complete</span>
                                        {% else %}
                                            <span class="new badge blue" data-badge-caption="">Pending</span>
                                        {% endif %}
                                    </div>
                                </div>
                                <div class="collapsible-body row" style="display: none;">
                                    <div class="col s4 ">
                                        {% if transaction.in_going %}
                                            From address:&nbsp;
                                        {% else %}
                                            To address:&nbsp;
                                        {% endif %}
                                        <br>
                                        <a href="{{ transaction.address|iota_hash_info_url }}">
                                            {{ transaction.address|truncatechars:30 }}
                                        </a>
                                        <br>
                                        {% if transaction.email %}
                                            <span>({{ transaction.email }})</span>
                                        {% endif %}

                                    </div>
                                    <div class="col s4 ">
                                        Bundle:<br>
                                        <a href="{{ transaction.bundle_hash|iota_hash_info_url }}">
                                            {{ transaction.bundle_hash|truncatechars:30 }}
                                        </a>
                                    </div>
                                    <div class="col s4">
                                        Transaction:<br>
                                        <a href="{{ transaction.hash|iota_hash_info_url }}">
                                            {{ transaction.hash|truncatechars:30 }}
                                        </a>
                                    </div>
                                </div>
                            </li>

                        {% endfor %}
                    </ul>
                </div>
            </div>
        </div>

    </div>
{% endblock %}

{% block custom_scripts %}
    <script>
        {% if message %}
            $(document).ready(function () {
                window.showMessageBox('{{ message }}', '{{ message_type|default:"info" }}')
            });
        {% endif %}
    </script>
{% endblock %}